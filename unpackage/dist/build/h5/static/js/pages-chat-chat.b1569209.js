(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-chat-chat"],{"0d56":function(t,n,e){"use strict";var i;e.d(n,"b",(function(){return a})),e.d(n,"c",(function(){return o})),e.d(n,"a",(function(){return i}));var a=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("v-uni-view",{staticClass:"chat-list"},[e("v-uni-view",{staticClass:"time"},[t._v(t._s(t.time))]),e("v-uni-view",{staticClass:"chat-container",style:t.imgDirection},[e("v-uni-view",{staticClass:"left"},[e("v-uni-image",{staticClass:"img",attrs:{src:t.img}})],1),e("v-uni-view",{staticClass:"text-container"},[e("v-uni-text",{staticClass:"title",style:t.titleDirection},[t._v(t._s(t.title))]),e("v-uni-text",{staticClass:"message",style:t.messageDirection},[t._v(t._s(t.message))])],1),e("v-uni-view",{staticClass:"right"})],1)],1)},o=[]},"321f":function(t,n,e){"use strict";e.r(n);var i=e("0d56"),a=e("f792");for(var o in a)"default"!==o&&function(t){e.d(n,t,(function(){return a[t]}))}(o);e("6df2");var r,u=e("f0c5"),s=Object(u["a"])(a["default"],i["b"],i["c"],!1,null,"4ff7290e",null,!1,i["a"],r);n["default"]=s.exports},"3ec6":function(t,n,e){var i=e("3f73");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var a=e("4f06").default;a("641abcc8",i,!0,{sourceMap:!1,shadowMode:!1})},"3f73":function(t,n,e){var i=e("24fb");n=i(!1),n.push([t.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.time[data-v-4ff7290e]{text-align:center;padding-top:%?50?%;font-size:11px;color:#61666d}.chat-container[data-v-4ff7290e]{display:flex;padding:%?10?% 0}.left[data-v-4ff7290e], .right[data-v-4ff7290e]{width:40px;padding:%?20?% %?24?%}.left .img[data-v-4ff7290e], .right .img[data-v-4ff7290e]{width:40px;height:40px;border-radius:5px;display:block}.text-container[data-v-4ff7290e]{flex:1;display:flex;flex-direction:column}.text-container .title[data-v-4ff7290e]{font-size:12px;color:#61666d;padding:%?15?% 0}.text-container .message[data-v-4ff7290e]{padding:%?20?%;background-color:#fff;border-radius:%?10?%;font-size:15px}',""]),t.exports=n},4576:function(t,n,e){"use strict";e.r(n);var i=e("9347"),a=e("70da");for(var o in a)"default"!==o&&function(t){e.d(n,t,(function(){return a[t]}))}(o);e("506c");var r,u=e("f0c5"),s=Object(u["a"])(a["default"],i["b"],i["c"],!1,null,"a64f7ac0",null,!1,i["a"],r);n["default"]=s.exports},"506c":function(t,n,e){"use strict";var i=e("af1c"),a=e.n(i);a.a},"50d9":function(t,n,e){var i=e("24fb");n=i(!1),n.push([t.i,".key-input[data-v-432ad39e]{width:100%;\n\t/* height: 60px; */position:fixed;left:0;z-index:9}.back[data-v-432ad39e]{height:calc(100vh - 60px)}.form[data-v-432ad39e]{\n\t/* height: 60px; */padding:10px 20px;background-color:#fff;border-top:2px solid #f5f5f5;display:flex}.form uni-input[data-v-432ad39e]{background-color:#f0f3f8;padding:0 10px;border-radius:5px;flex:1;height:30px;box-sizing:border-box;margin-right:10px}.form uni-button[data-v-432ad39e]{width:40px;height:30px;line-height:30px;font-size:15px;padding:0;border:none;background-color:initial}",""]),t.exports=n},"6df2":function(t,n,e){"use strict";var i=e("3ec6"),a=e.n(i);a.a},"70da":function(t,n,e){"use strict";e.r(n);var i=e("ad45"),a=e.n(i);for(var o in i)"default"!==o&&function(t){e.d(n,t,(function(){return i[t]}))}(o);n["default"]=a.a},"84f9":function(t,n,e){"use strict";e.r(n);var i=e("9622"),a=e("cf82");for(var o in a)"default"!==o&&function(t){e.d(n,t,(function(){return a[t]}))}(o);e("c5d6");var r,u=e("f0c5"),s=Object(u["a"])(a["default"],i["b"],i["c"],!1,null,"432ad39e",null,!1,i["a"],r);n["default"]=s.exports},8667:function(t,n,e){var i=e("50d9");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var a=e("4f06").default;a("179a3369",i,!0,{sourceMap:!1,shadowMode:!1})},9347:function(t,n,e){"use strict";e.d(n,"b",(function(){return a})),e.d(n,"c",(function(){return o})),e.d(n,"a",(function(){return i}));var i={uniNavBar:e("74e5").default},a=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("v-uni-view",{staticClass:"chat"},[e("uni-nav-bar",{attrs:{border:!1,statusBar:!0,fixed:!0}},[e("v-uni-view",{staticClass:"nav-bar",attrs:{slot:"default"},slot:"default"},[t._v(t._s(t.title))])],1),t.userInfo.id?e("v-uni-view",{staticClass:"chat-record"},[e("v-uni-scroll-view",{staticClass:"scroll-view",attrs:{"scroll-y":!0,"scroll-top":t.scrollTop,"scroll-with-animation":"true"},on:{scroll:function(n){arguments[0]=n=t.$handleEvent(n),t.scroll.apply(void 0,arguments)}}},t._l(t.recordList,(function(n,i){return e("ChatList",{key:i,attrs:{direction:n.user.nickname==t.userInfo.nickname?"right":"left",title:n.user.nickname,img:n.user.avatarUrl,message:n.content,time:t.time(i)}})})),1),e("KeyInput",{ref:"input",attrs:{bottom:t.bottom},on:{focus:function(n){arguments[0]=n=t.$handleEvent(n),t.focus.apply(void 0,arguments)},blur:function(n){arguments[0]=n=t.$handleEvent(n),t.blur.apply(void 0,arguments)},pub:function(n){arguments[0]=n=t.$handleEvent(n),t.pub.apply(void 0,arguments)}}})],1):e("v-uni-view",[t._v("登录后即可体验即时聊天功能")])],1)},o=[]},9536:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i={name:"ChatList",props:{direction:{type:String,default:"left"},title:{type:String,default:"标题"},img:{type:String,default:"图片"},message:{type:String,default:"内容"},time:{default:"2022-05-02"}},computed:{imgDirection:function(){if("right"===this.direction)return"flex-direction: row-reverse;"},titleDirection:function(){if("right"===this.direction)return"text-align: right;"},messageDirection:function(){return"right"===this.direction?"align-self: flex-end;":"align-self: flex-start;"}}};n.default=i},9622:function(t,n,e){"use strict";var i;e.d(n,"b",(function(){return a})),e.d(n,"c",(function(){return o})),e.d(n,"a",(function(){return i}));var a=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("v-uni-view",{staticClass:"key-input",style:{bottom:(t.bottom?t.bottom:t.inputBottom)+"px"}},[e("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:t.backShow,expression:"backShow"}],staticClass:"back",on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.pubBack.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"form"},[e("v-uni-input",{attrs:{type:"text",placeholder:t.placeholder,"adjust-position":!1,focus:t.isFocus,maxlength:"300"},on:{keyboardheightchange:function(n){arguments[0]=n=t.$handleEvent(n),t.keyChange.apply(void 0,arguments)},focus:function(n){arguments[0]=n=t.$handleEvent(n),t.focus.apply(void 0,arguments)},blur:function(n){arguments[0]=n=t.$handleEvent(n),t.blur.apply(void 0,arguments)}},model:{value:t.inputValue,callback:function(n){t.inputValue=n},expression:"inputValue"}}),e("v-uni-button",{on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.pub.apply(void 0,arguments)}}},[t._v("发表")])],1)],1)},o=[]},"984f":function(t,n,e){"use strict";e("a9e3"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i={name:"KeyInput",props:{placeholder:{type:String,default:function(){return"发表一条友善的评论"}},bottom:{type:Number,default:0}},data:function(){return{backShow:!1,inputValue:"",inputBottom:0,isFocus:!1}},mounted:function(){uni.$on("pubSuccess",this.clear)},methods:{pub:function(){this.$emit("pub",this.inputValue)},clear:function(){this.inputValue=""},keyChange:function(t){this.inputBottom=t.detail.height},focus:function(t){this.$emit("focus"),this.isFocus=!0},blur:function(t){this.isFocus=!1,this.$emit("blur"),this.inputBottom=0}},beforeDestroy:function(){uni.$off("pubSuccess",this.clear)}};n.default=i},abfe:function(t,n,e){var i=e("24fb");n=i(!1),n.push([t.i,".nav-bar[data-v-a64f7ac0]{font-size:20px;font-weight:600;margin:0 auto;line-height:44px}.chat[data-v-a64f7ac0]{background-color:#f5f5f7}.chat-record[data-v-a64f7ac0]{height:calc(100vh - 44px - 50px)}.scroll-view[data-v-a64f7ac0]{height:calc(100% - 60px)}",""]),t.exports=n},ad45:function(t,n,e){"use strict";var i=e("4ea4");e("ac1f"),e("5319"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=i(e("5530")),o=e("26cb"),r=e("3eee"),u=i(e("321f")),s=i(e("84f9")),c={data:function(){return{chatData:null,recordList:[],onLine:0,bottom:50,scrollTop:0}},components:{ChatList:u.default,KeyInput:s.default},onShow:function(){(0,r.connectSocket)()},onLoad:function(){var t=this;uni.onSocketOpen((function(n){t.$nextTick((function(){t.sendMsg({userInfo:t.userInfo})}))})),uni.onSocketMessage((function(n){var e=JSON.parse(n.data);t.onLine=e.onLineCount,Array.isArray(e.data)?(t.recordList=e.data,setTimeout((function(){t.scrollTop+=999999}))):e.data.content&&(t.recordList.push(e.data),e.data.user.id===t.userInfo.id&&setTimeout((function(){t.scrollTop+=500})))}))},onUnload:function(){uni.closeSocket()},computed:(0,a.default)((0,a.default)({},(0,o.mapGetters)(["userInfo"])),{},{title:function(){return"聊天(".concat(this.onLine,"人在线)")}}),methods:{sendMsg:function(t){var n=this;uni.sendSocketMessage({data:JSON.stringify(t),fail:function(t){uni.showToast({title:t,icon:"error"})},success:function(){n.$refs.input.inputValue=""}})},time:function(t){var n,e,i=new Date(this.recordList[t].createTime.replace("Z","")).getTime(),a=new Date((null===(n=this.recordList[t-1])||void 0===n||null===(e=n.createTime)||void 0===e?void 0:e.replace("Z",""))||0).getTime();return i-a<=12e4?"":this.$timeHandle(i)},scroll:function(t){this.scrollTop=t.detail.scrollTop},focus:function(){this.bottom=0,uni.hideTabBar()},blur:function(){var t=this;setTimeout((function(){t.bottom=50,uni.showTabBar()}))},pub:function(t){this.sendMsg({userInfo:this.userInfo,message:t})}},watch:{userInfo:function(t){t.id?this.sendMsg({userInfo:this.userInfo}):uni.closeSocket()}}};n.default=c},af1c:function(t,n,e){var i=e("abfe");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var a=e("4f06").default;a("7f9bf0c3",i,!0,{sourceMap:!1,shadowMode:!1})},c5d6:function(t,n,e){"use strict";var i=e("8667"),a=e.n(i);a.a},cf82:function(t,n,e){"use strict";e.r(n);var i=e("984f"),a=e.n(i);for(var o in i)"default"!==o&&function(t){e.d(n,t,(function(){return i[t]}))}(o);n["default"]=a.a},f792:function(t,n,e){"use strict";e.r(n);var i=e("9536"),a=e.n(i);for(var o in i)"default"!==o&&function(t){e.d(n,t,(function(){return i[t]}))}(o);n["default"]=a.a}}]);